
<!Doctype html>
<html>
<head>
<!-- pour spécifier au naviageteur comment afficher la page -->
<meta name="viewport" content="width=device-width, initial-scale=1" charset="utf-8">

<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
<script src="lib/Chart.js"></script>
<script>
function showMessage(text) {
	//alert(text);
}
		var id=0;
	
		var ws = new WebSocket('ws://192.168.1.101:8080/getGlobalInformations');
		showMessage('Connecting...');
		ws.onopen = function() {
			showMessage('Connected !');
			//ws.send("");
		};
		ws.onclose = function() {
			showMessage('Lost connection');
		};
		ws.onmessage = function(msg) {
		
			var jsonObj = JSON.parse(msg.data);

			for (var i in jsonObj) {

			    var jsonObj2 = jsonObj[i];

				if(jsonObj2.id == id){
					if(jsonObj2.informations[0] == "graph"){
					graph(jsonObj2.informations);
					}else{
					showMessage(msg.data);
					}
				}
			}
		};
		
function setId(){
	id = $("#idIntervention").val();
	ws.send("");
}		

</script>
</head>
			<div data-role="collapsible" data-collapsed="true" data-theme="b">
                <h2>ID Intervention</h2>
                <label for="idIntervention">Nom :</label> <input type="text" name="idIntervention" id="idIntervention" value="" />
                <input type="button" name="submit" value="Récupérer intervention" onclick="setId();" />
			</div>


			<div data-role="collapsible" data-collapsed="true" data-theme="b">
                <h2>Intervention</h2>
                <div id="intervention"></div>
			</div>

			<div data-role="collapsible" data-collapsed="true" data-theme="b">
                <h2>Agents</h2>
                <div id="agents"></div>
			</div>

			<div data-role="collapsible" data-collapsed="true" data-theme="b">
                <h2>Nombre de victimes totales</h2>
                <div id="nbVictime"></div>
			</div>


			<div id="graph1" data-role="collapsible" data-collapsed="true" data-theme="b">
                <h2>Nombre de victimes par catégorie</h2>
                <canvas id="canvas" height="450" width="800"></canvas>
		    </div>

<script>

	
    function graph(jsonObj){
        var max = Math.max(jsonObj[2], Math.max(jsonObj[3], Math.max(jsonObj[4], Math.max(jsonObj[5], jsonObj[6]))));

        document.getElementById('nbVictime').innerHTML = "Nombre de victimes recensées à l'heure actuelle : "+parseInt(jsonObj[1]);
        document.getElementById('intervention').innerHTML = "Description de l'intervention : "+jsonObj[7];
        document.getElementById('agents').innerHTML = "Nombre d'agents sur place : "+jsonObj[8];

        var barChartData = {
                labels : ["U3","U2","U1","EU","Personne décédée"],
                datasets : [
                    {
                        fillColor : "rgba(22,220,220,0.5)",
                        strokeColor : "rgba(22,220,220,1)",

                        data : [ parseInt(jsonObj[2]), parseInt(jsonObj[3]), parseInt(jsonObj[4]), parseInt(jsonObj[5]), parseInt(jsonObj[6])]
                    }

                ]

        };

        var option = {	//Boolean - If we want to override with a hard coded scale
            scaleOverride : true,

            //** Required if scaleOverride is true **
            //Number - The number of steps in a hard coded scale
            scaleSteps : parseInt(max),
            //Number - The value jump in the hard coded scale
            scaleStepWidth : 1,
            //Number - The scale starting value
            scaleStartValue : 0,

            animation : false,
        }

        var myLine = new Chart(document.getElementById("canvas").getContext("2d")).Bar(barChartData,option);
    }
</script>